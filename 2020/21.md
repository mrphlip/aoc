# 21 &ndash; Logic Grids 2: This Time It's Personal
To be honest, the major challenge with this puzzle was understanding the requirements. The instructions were clear enough, it was just the framing story of ingredients and allergens didn't... quite fit the underlying puzzle in rather confusing ways. Like, that each ingredient contains at most one allergen, and each allergen is contained in exactly one ingredient, is... not how actual allergens work, so the [piggybacking](https://magic.wizards.com/en/articles/archive/making-magic/piggybacking-2012-08-16) isn't really there.

Also contributing to this confusion is the fact that the sample example isn't worked out, they just show the input and then give the answer, where previous days have shown the steps in more detail. And, like, maybe if they went into that detail, the puzzle would be too easy for day 21. But it means that I couldn't use those worked steps to clear up my confusion about the puzzle definition.

But once that initial confusion is out of the way, the actual puzzle becomes pretty simple: each line of the input is an assertion that each allergen is included in the list of ingredients on that line. And since each allergen can only be in one ingredient, when the same allergen appears on multiple lines, that ingredient has to be in both, so we can take the intersection. And once we take all those intersections to narrow down the possibilities, there are some ingredients that have been ruled out as being _any_ of the allergens, and that gets us our part 1.

For part 2, we have to finish solving the logic grid, which we solve in basically the same way as [puzzle 16](16.md), but only in one direction &ndash; because every allergen maps to exactly one ingredient, but every ingredient maps to _at most_ one allergen... so when an allergen has only one candidate ingredient, we can draw conclusions from that, but not vice-versa. Which makes the code a lot simpler, as we only need to scan the grid in one direction in each step... looking for allergens with only one candidate ingredient that we haven't already processed, and then removing that ingredient from the candidate lists for all the other allergens.

And finally, for the answer to part 2 we're supposed to generate the list of allergenic ingredients, sorted alphabetically by their allergens, which is handy, because Haskell `Map`s are binary-tree-based, so iterating them automatically pulls out the entries sorted by key. So if we have a map of allergen to ingredient (which is what we naturally have), then `elems allergenmap` is automatically the list of ingredients in the order we want. Nice when things just happen to fall into place.
